/** Gateway */ 
(function(a){var b=function(){this.listeners={}};b.prototype.on=function(a,b){if(typeof b!="function")throw"on(eventName, callback): callback must be function: "+b;this.listeners[a]==null?this.listeners[a]=[b]:this.listeners[a].push(b)},b.prototype.fire=function(a,b){var c=this.listeners[a];if(c==null)return;var d;for(d in c)c[d](b)};var c=function(){this.listeners=new b};c.prototype.init=function(a){if(a===undefined||a.url===undefined)throw"Gateful.init: opts.url must be set";this.baseUrl=a.url,this.opts=a||{}},c.prototype.on=function(a,b){this.listeners.on(a,b)},c.prototype.api=function(a,b,c,d){typeof b=="function"&&(d=c,c=b,b={}),this.listeners.fire("get",{url:a,callback:c});var e={url:this.baseUrl+a,method:b&&b.method||"GET",params:b&&b.params,doit:!0};this.listeners.fire("send",{request:e});if(e.doit===!1)return;var f=b&&b.params,g=this;jQuery.ajax({url:e.url,type:e.method,data:e.params,success:function(a,b,d){var f=undefined;try{var h=jQuery.parseJSON(a);h.result?f=h.result:f=h}catch(i){}g.listeners.fire("receive",{request:e,response:f,data:a}),c(e,f,a)},error:function(a){g.listeners.fire("error",{error:a,request:e}),d!=null&&d({error:a,request:e})},complete:function(){g.listeners.fire("complete",{})}})},a.Gateful=new c})(this)
